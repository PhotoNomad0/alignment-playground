import React, { useState, useRef } from 'react';
import './App.css';
import Lexer from "wordmap-lexer";
import {removeUsfmMarkers} from "./utils/usfmHelpers";
import {tokenizeVerseObjects} from "./utils/verseObjects";

const wordStyle = {backgroundColor: 'lightblue', margin: '20px 25%', textAlign: 'center', fontSize: '40px'};
const targetVerseText = 'Paul, a servant of God and an apostle of Jesus Christ, for the faith of the chosen people of God and knowledge of the truth that agrees with godliness,';
const sourceVerse = {
  "verseObjects": [
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "Παῦλος",
      "tag": "w",
      "type": "word",
      "lemma": "Παῦλος",
      "strong": "G39720",
      "morph": "Gr,N,,,,,NMS,",
      "tw": "rc://*/tw/dict/bible/names/paul"
    },
    {
      "type": "text",
      "text": ", "
    },
    {
      "text": "δοῦλος",
      "tag": "w",
      "type": "word",
      "lemma": "δοῦλος",
      "strong": "G14010",
      "morph": "Gr,N,,,,,NMS,",
      "tw": "rc://*/tw/dict/bible/other/servant"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "Θεοῦ",
      "tag": "w",
      "type": "word",
      "lemma": "θεός",
      "strong": "G23160",
      "morph": "Gr,N,,,,,GMS,",
      "tw": "rc://*/tw/dict/bible/kt/god"
    },
    {
      "type": "text",
      "text": ", "
    },
    {
      "text": "ἀπόστολος",
      "tag": "w",
      "type": "word",
      "lemma": "ἀπόστολος",
      "strong": "G06520",
      "morph": "Gr,N,,,,,NMS,",
      "tw": "rc://*/tw/dict/bible/kt/apostle"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "δὲ",
      "tag": "w",
      "type": "word",
      "lemma": "δέ",
      "strong": "G11610",
      "morph": "Gr,CC,,,,,,,,"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "Ἰησοῦ",
      "tag": "w",
      "type": "word",
      "lemma": "Ἰησοῦς",
      "strong": "G24240",
      "morph": "Gr,N,,,,,GMS,",
      "tw": "rc://*/tw/dict/bible/kt/jesus"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "Χριστοῦ",
      "tag": "w",
      "type": "word",
      "lemma": "χριστός",
      "strong": "G55470",
      "morph": "Gr,N,,,,,GMS,",
      "tw": "rc://*/tw/dict/bible/kt/christ"
    },
    {
      "type": "text",
      "text": ", "
    },
    {
      "text": "κατὰ",
      "tag": "w",
      "type": "word",
      "lemma": "κατά",
      "strong": "G25960",
      "morph": "Gr,P,,,,,A,,,"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "πίστιν",
      "tag": "w",
      "type": "word",
      "lemma": "πίστις",
      "strong": "G41020",
      "morph": "Gr,N,,,,,AFS,",
      "tw": "rc://*/tw/dict/bible/kt/faith"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "ἐκλεκτῶν",
      "tag": "w",
      "type": "word",
      "lemma": "ἐκλεκτός",
      "strong": "G15880",
      "morph": "Gr,NS,,,,GMP,",
      "tw": "rc://*/tw/dict/bible/kt/elect"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "Θεοῦ",
      "tag": "w",
      "type": "word",
      "lemma": "θεός",
      "strong": "G23160",
      "morph": "Gr,N,,,,,GMS,",
      "tw": "rc://*/tw/dict/bible/kt/god"
    },
    {
      "type": "text",
      "text": ", "
    },
    {
      "text": "καὶ",
      "tag": "w",
      "type": "word",
      "lemma": "καί",
      "strong": "G25320",
      "morph": "Gr,CC,,,,,,,,"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "ἐπίγνωσιν",
      "tag": "w",
      "type": "word",
      "lemma": "ἐπίγνωσις",
      "strong": "G19220",
      "morph": "Gr,N,,,,,AFS,",
      "tw": "rc://*/tw/dict/bible/other/know"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "ἀληθείας",
      "tag": "w",
      "type": "word",
      "lemma": "ἀλήθεια",
      "strong": "G02250",
      "morph": "Gr,N,,,,,GFS,",
      "tw": "rc://*/tw/dict/bible/kt/true"
    },
    {
      "type": "text",
      "text": ", "
    },
    {
      "text": "τῆς",
      "tag": "w",
      "type": "word",
      "lemma": "ὁ",
      "strong": "G35880",
      "morph": "Gr,EA,,,,GFS,"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "κατ’",
      "tag": "w",
      "type": "word",
      "lemma": "κατά",
      "strong": "G25960",
      "morph": "Gr,P,,,,,A,,,"
    },
    {
      "type": "text",
      "text": " "
    },
    {
      "text": "εὐσέβειαν",
      "tag": "w",
      "type": "word",
      "lemma": "εὐσέβεια",
      "strong": "G21500",
      "morph": "Gr,N,,,,,AFS,",
      "tw": "rc://*/tw/dict/bible/kt/godly"
    },
    {
      "type": "text",
      "text": "\n\n"
    }
  ]
};
const alignedTokens = [
  {
    "sourceNgram": [
      {
        "text": "Παῦλος",
        "position": 0,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G39720",
        "lemma": "Παῦλος",
        "morph": "Gr,N,,,,,NMS,",
        "index": 0
      }
    ],
    "targetNgram": [
      {
        "text": "Paul",
        "occurrence": 1,
        "occurrences": 1,
        "position": 0,
        "suggestion": false,
        "index": 0
      }
    ],
    "index": 0,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "δοῦλος",
        "position": 1,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G14010",
        "lemma": "δοῦλος",
        "morph": "Gr,N,,,,,NMS,",
        "index": 1
      }
    ],
    "targetNgram": [
      {
        "text": "a",
        "occurrence": 1,
        "occurrences": 1,
        "position": 1,
        "suggestion": false,
        "index": 1
      },
      {
        "text": "servant",
        "occurrence": 1,
        "occurrences": 1,
        "position": 2,
        "suggestion": false,
        "index": 2
      }
    ],
    "index": 1,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "Θεοῦ",
        "position": 2,
        "occurrence": 1,
        "occurrences": 2,
        "strong": "G23160",
        "lemma": "θεός",
        "morph": "Gr,N,,,,,GMS,",
        "index": 2
      }
    ],
    "targetNgram": [
      {
        "text": "of",
        "occurrence": 1,
        "occurrences": 5,
        "position": 3,
        "suggestion": false,
        "index": 3
      },
      {
        "text": "God",
        "occurrence": 1,
        "occurrences": 2,
        "position": 4,
        "suggestion": false,
        "index": 4
      }
    ],
    "index": 2,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "ἀπόστολος",
        "position": 3,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G06520",
        "lemma": "ἀπόστολος",
        "morph": "Gr,N,,,,,NMS,",
        "index": 3
      }
    ],
    "targetNgram": [
      {
        "text": "an",
        "occurrence": 1,
        "occurrences": 1,
        "position": 6,
        "suggestion": false,
        "index": 6
      },
      {
        "text": "apostle",
        "occurrence": 1,
        "occurrences": 1,
        "position": 7,
        "suggestion": false,
        "index": 7
      }
    ],
    "index": 3,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "δὲ",
        "position": 4,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G11610",
        "lemma": "δέ",
        "morph": "Gr,CC,,,,,,,,",
        "index": 4
      }
    ],
    "targetNgram": [
      {
        "text": "and",
        "occurrence": 1,
        "occurrences": 2,
        "position": 5,
        "suggestion": false,
        "index": 5
      }
    ],
    "index": 4,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "Ἰησοῦ",
        "position": 5,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G24240",
        "lemma": "Ἰησοῦς",
        "morph": "Gr,N,,,,,GMS,",
        "index": 5
      }
    ],
    "targetNgram": [
      {
        "text": "of",
        "occurrence": 2,
        "occurrences": 5,
        "position": 8,
        "suggestion": false,
        "index": 8
      },
      {
        "text": "Jesus",
        "occurrence": 1,
        "occurrences": 1,
        "position": 9,
        "suggestion": false,
        "index": 9
      }
    ],
    "index": 5,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "Χριστοῦ",
        "position": 6,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G55470",
        "lemma": "χριστός",
        "morph": "Gr,N,,,,,GMS,",
        "index": 6
      }
    ],
    "targetNgram": [
      {
        "text": "Christ",
        "occurrence": 1,
        "occurrences": 1,
        "position": 10,
        "suggestion": false,
        "index": 10
      }
    ],
    "index": 6,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "κατὰ",
        "position": 7,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G25960",
        "lemma": "κατά",
        "morph": "Gr,P,,,,,A,,,",
        "index": 7
      }
    ],
    "targetNgram": [
      {
        "text": "for",
        "occurrence": 1,
        "occurrences": 1,
        "position": 11,
        "suggestion": false,
        "index": 11
      }
    ],
    "index": 7,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "πίστιν",
        "position": 8,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G41020",
        "lemma": "πίστις",
        "morph": "Gr,N,,,,,AFS,",
        "index": 8
      }
    ],
    "targetNgram": [
      {
        "text": "the",
        "occurrence": 1,
        "occurrences": 3,
        "position": 12,
        "suggestion": false,
        "index": 12
      },
      {
        "text": "faith",
        "occurrence": 1,
        "occurrences": 1,
        "position": 13,
        "suggestion": false,
        "index": 13
      }
    ],
    "index": 8,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "ἐκλεκτῶν",
        "position": 9,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G15880",
        "lemma": "ἐκλεκτός",
        "morph": "Gr,NS,,,,GMP,",
        "index": 9
      }
    ],
    "targetNgram": [
      {
        "text": "of",
        "occurrence": 3,
        "occurrences": 5,
        "position": 14,
        "suggestion": false,
        "index": 14
      },
      {
        "text": "the",
        "occurrence": 2,
        "occurrences": 3,
        "position": 15,
        "suggestion": false,
        "index": 15
      },
      {
        "text": "chosen",
        "occurrence": 1,
        "occurrences": 1,
        "position": 16,
        "suggestion": false,
        "index": 16
      },
      {
        "text": "people",
        "occurrence": 1,
        "occurrences": 1,
        "position": 17,
        "suggestion": false,
        "index": 17
      }
    ],
    "index": 9,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "Θεοῦ",
        "position": 10,
        "occurrence": 2,
        "occurrences": 2,
        "strong": "G23160",
        "lemma": "θεός",
        "morph": "Gr,N,,,,,GMS,",
        "index": 10
      }
    ],
    "targetNgram": [
      {
        "text": "of",
        "occurrence": 4,
        "occurrences": 5,
        "position": 18,
        "suggestion": false,
        "index": 18
      },
      {
        "text": "God",
        "occurrence": 2,
        "occurrences": 2,
        "position": 19,
        "suggestion": false,
        "index": 19
      }
    ],
    "index": 10,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "καὶ",
        "position": 11,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G25320",
        "lemma": "καί",
        "morph": "Gr,CC,,,,,,,,",
        "index": 11
      }
    ],
    "targetNgram": [
      {
        "text": "and",
        "occurrence": 2,
        "occurrences": 2,
        "position": 20,
        "suggestion": false,
        "index": 20
      }
    ],
    "index": 11,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "ἐπίγνωσιν",
        "position": 12,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G19220",
        "lemma": "ἐπίγνωσις",
        "morph": "Gr,N,,,,,AFS,",
        "index": 12
      }
    ],
    "targetNgram": [
      {
        "text": "knowledge",
        "occurrence": 1,
        "occurrences": 1,
        "position": 21,
        "suggestion": false,
        "index": 21
      }
    ],
    "index": 12,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "ἀληθείας",
        "position": 13,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G02250",
        "lemma": "ἀλήθεια",
        "morph": "Gr,N,,,,,GFS,",
        "index": 13
      }
    ],
    "targetNgram": [
      {
        "text": "of",
        "occurrence": 5,
        "occurrences": 5,
        "position": 22,
        "suggestion": false,
        "index": 22
      },
      {
        "text": "the",
        "occurrence": 3,
        "occurrences": 3,
        "position": 23,
        "suggestion": false,
        "index": 23
      },
      {
        "text": "truth",
        "occurrence": 1,
        "occurrences": 1,
        "position": 24,
        "suggestion": false,
        "index": 24
      }
    ],
    "index": 13,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "τῆς",
        "position": 14,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G35880",
        "lemma": "ὁ",
        "morph": "Gr,EA,,,,GFS,",
        "index": 14
      }
    ],
    "targetNgram": [
      {
        "text": "that",
        "occurrence": 1,
        "occurrences": 1,
        "position": 25,
        "suggestion": false,
        "index": 25
      }
    ],
    "index": 14,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "κατ’",
        "position": 15,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G25960",
        "lemma": "κατά",
        "morph": "Gr,P,,,,,A,,,",
        "index": 15
      }
    ],
    "targetNgram": [
      {
        "text": "agrees",
        "occurrence": 1,
        "occurrences": 1,
        "position": 26,
        "suggestion": false,
        "index": 26
      },
      {
        "text": "with",
        "occurrence": 1,
        "occurrences": 1,
        "position": 27,
        "suggestion": false,
        "index": 27
      }
    ],
    "index": 15,
    "isSuggestion": false
  },
  {
    "sourceNgram": [
      {
        "text": "εὐσέβειαν",
        "position": 16,
        "occurrence": 1,
        "occurrences": 1,
        "strong": "G21500",
        "lemma": "εὐσέβεια",
        "morph": "Gr,N,,,,,AFS,",
        "index": 16
      }
    ],
    "targetNgram": [
      {
        "text": "godliness",
        "occurrence": 1,
        "occurrences": 1,
        "position": 28,
        "suggestion": false,
        "index": 28
      }
    ],
    "index": 16,
    "isSuggestion": false
  }
];

let targetTokens = [];
let sourceTokens = [];

if (targetVerseText) {
  targetTokens = Lexer.tokenize(removeUsfmMarkers(targetVerseText));
}

if (sourceVerse) {
  sourceTokens = tokenizeVerseObjects(sourceVerse.verseObjects);
}

// TRICKY: do not show word list if there is no source bible.
let words = [];

if (sourceVerse) {
  words = getLabeledTargetTokens(targetTokens, alignedTokens);
}


const App = () => {

  const dragItem = useRef();
  const dragOverItem = useRef();
  const [list, setList] = useState(['Item 1','Item 2','Item 3','Item 4','Item 5','Item 6']);

  const dragStart = (e, position) => {
    dragItem.current = position;
    console.log(e.target.innerHTML);
  };

  const dragEnter = (e, position) => {
    dragOverItem.current = position;
    console.log(e.target.innerHTML);
  };

  const drop = (e) => {
    const copyListItems = [...list];
    const dragItemContent = copyListItems[dragItem.current];
    copyListItems.splice(dragItem.current, 1);
    copyListItems.splice(dragOverItem.current, 0, dragItemContent);
    dragItem.current = null;
    dragOverItem.current = null;
    setList(copyListItems);
  };

  return (
    <>
      {
        list&&
        list.map((item, index) => {
          return (
            <div style={wordStyle}
                 onDragStart={(e) => dragStart(e, index)}
                 onDragEnter={(e) => dragEnter(e, index)}
                 onDragEnd={drop}
                 key={index}
                 draggable>
              {item}
            </div>
          );
        })}
    </>
  );
};

function  getLabeledTargetTokens(targetTokens, alignedTokens) {
  return targetTokens.map(token => {
    let isUsed = false;

    for (const usedToken of alignedTokens) {
      if (token.toString() === usedToken.toString()
        && token.occurrence === usedToken.occurrence
        && token.occurrences === usedToken.occurrences) {
        isUsed = true;
        break;
      }
    }
    token.disabled = isUsed;
    return token;
  });
}

export default App;
